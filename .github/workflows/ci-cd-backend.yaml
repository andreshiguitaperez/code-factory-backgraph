name: CI/CD Backend

on:
  push:
    branches:
      - busqueda-vuelos  # Ajusta el nombre de tu rama si es necesario

env:
  VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN_BACKEND }}
  VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID_BACKEND }}
  VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID_BACKEND }}

jobs:
  Build:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/busqueda-vuelos'  # Aseg√∫rate de que coincida con tu rama
    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: '11'
      - name: Install dependencies
        run: mvn clean install -DskipTests
      - name: Build project
        run: mvn clean package -DskipTests

  Deploy:
    needs: Build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/busqueda-vuelos'  # Ajusta el nombre de tu rama si es necesario
    steps:
      - uses: actions/checkout@v2
      - name: Install Docker
        run: |
          sudo apt-get update
          sudo apt-get install docker.io
      - name: Build Docker image
        run: docker build -t backendflightsearch .
      - name: Login to Vercel
        run: vercel login --token=${{ secrets.VERCEL_TOKEN_BACKEND }}
      - name: Deploy to Vercel
        run: |
          vercel --prod --token=${{ secrets.VERCEL_TOKEN_BACKEND }} --confirm
